# Use official Golang image as the base
FROM golang:1.20-alpine AS builder

# Set working directory inside container
WORKDIR /app

# Copy the source code
COPY main.go .

# Build the Go application
RUN go mod init auth-api && \
    go mod tidy && \
    go build -o auth-api main.go

# Use a lightweight base image for the final stage
FROM alpine:latest

# Copy the compiled binary from the builder stage
COPY --from=builder /app/auth-api /auth-api

# Expose the required port
EXPOSE 8081

# Run the application
ENTRYPOINT ["/auth-api"]
